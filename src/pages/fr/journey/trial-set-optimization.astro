---
import Layout from '../../../layouts/Layout.astro';
import Navigation from '../../../components/Navigation.astro';
import { t } from '../../../i18n/translations';
import '../../../styles/global.css';

const lang = 'fr';
const base = import.meta.env.BASE_URL;
---

<Layout title="Optimisation des Essais | Parcours de Recherche">
  <Navigation lang={lang} currentPath="/fr/journey/trial-set-optimization" />

  <main class="min-h-screen bg-[#FFF9ED] relative">
    <div class="absolute inset-0 opacity-5 pointer-events-none">
      <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <pattern id="grid-opt" width="40" height="40" patternUnits="userSpaceOnUse">
            <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#003049" stroke-width="1"/>
          </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#grid-opt)" />
      </svg>
    </div>
    <!-- Hero Section -->
    <section class="relative py-20 px-6 overflow-hidden">


      <div class="max-w-5xl mx-auto relative z-10">
        <!-- Breadcrumb -->
        <div class="mb-8">
          <a href={base + "fr/journey"} class="text-sm text-[#003049]/60 hover:text-[#780000] transition-colors inline-flex items-center gap-2 font-figtree font-bold uppercase tracking-wider">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Retour au Parcours
          </a>
        </div>

        <!-- Title -->
        <div class="mb-8">
          <div class="inline-block px-4 py-2 bg-[#780000]/10 text-[#780000] rounded-lg text-sm font-bold uppercase tracking-widest mb-6 border border-[#780000]/20">
            Phase 3
          </div>
          <h1 class="font-figtree text-5xl md:text-6xl font-bold text-[#003049] mb-6 leading-tight">Construire la Machine</h1>
          <p class="font-figtree text-xl text-[#003049]/70 leading-relaxed max-w-3xl">
            Comment choisir 286 essais parmi 17 955 choix possibles ?
          </p>
        </div>
      </div>
    </section>

    <!-- Main Content -->
    <section class="py-12 px-6 relative">
      <div class="max-w-5xl mx-auto space-y-16">

        <!-- 1. The Problem -->
        <div class="bg-[#FFF9ED] border border-[#003049]/10 rounded-2xl overflow-hidden shadow-sm">
          <div class="grid md:grid-cols-12">
            <div class="md:col-span-1 bg-[#780000] flex items-center justify-center p-4">
              <div class="font-figtree text-4xl font-black text-[#FFF9ED] opacity-50 rotate-90 md:rotate-0">01</div>
            </div>
            <div class="md:col-span-11 p-8 md:p-12">
              <h2 class="font-figtree text-3xl font-bold text-[#003049] mb-6">Le Problème</h2>
              <div class="space-y-6">
                <p class="font-figtree text-lg text-[#003049]/80 leading-relaxed">
                  La conception prévoit 300 essais. Mais <strong>lesquels 300 ?</strong>
                </p>
                <p class="font-figtree text-lg text-[#003049]/80 leading-relaxed">
                  Les investissements vont de 1 à 10 jetons. Les probabilités de 5% à 95%. Les résultats de 0 à 39 jetons. L'espace factoriel complet contient <strong>17 955 essais possibles</strong>.
                </p>
                <div class="bg-[#003049]/5 border border-[#003049]/10 p-8 rounded-xl border-l-4 border-l-[#003049]">
                  <p class="font-figtree font-bold text-[#780000] mb-3 text-lg">Le défi :</p>
                  <p class="font-figtree text-lg text-[#003049]/80 leading-relaxed">
                    Tous les essais ne sont pas également informatifs. Certains nous en disent beaucoup sur les paramètres de la Théorie des Perspectives. D'autres sont redondants ou non informatifs. Nous avons besoin d'une <em class="italic font-serif">méthode systématique</em> pour sélectionner les meilleurs.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 2. Étape 1 : Générer l'Espace d'Essais -->
        <div class="pl-8 border-l-2 border-[#669bbc]/30">
          <div class="bg-[#FFF9ED] p-8 rounded-2xl border border-[#003049]/10 shadow-sm">
            <h2 class="font-figtree text-3xl font-bold text-[#003049] mb-8">Étape 1 : Générer l'Espace d'Essais</h2>

            <div class="space-y-8">
              <p class="font-figtree text-xl text-[#003049]/80 leading-relaxed font-light">
                D'abord, créer tous les essais possibles. Pour chaque niveau d'investissement (1–10 jetons), générer toutes les combinaisons de résultats et de probabilités.
              </p>

              <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-[#FFF9ED] border border-[#669bbc]/20 p-8 rounded-xl shadow-sm hover:shadow-md transition-shadow">
                  <p class="font-figtree text-lg font-bold text-[#669bbc] mb-4">Plan Factoriel Complet</p>
                  <div class="space-y-3 font-figtree text-[#003049]/80">
                    <p class="flex items-center gap-2"><span class="w-1.5 h-1.5 rounded-full bg-[#669bbc]"></span><strong>Investissements :</strong> 1–10 jetons</p>
                    <p class="flex items-center gap-2"><span class="w-1.5 h-1.5 rounded-full bg-[#669bbc]"></span><strong>Résultats :</strong> Pertes et gains nets</p>
                    <p class="flex items-center gap-2"><span class="w-1.5 h-1.5 rounded-full bg-[#669bbc]"></span><strong>Probabilités :</strong> 5% à 95%</p>
                  </div>
                </div>

                <div class="bg-[#780000]/5 border border-[#780000]/10 p-8 rounded-xl flex flex-col justify-center items-center text-center">
                  <p class="font-figtree text-sm font-bold text-[#780000] mb-2 uppercase tracking-wide">Total Généré</p>
                  <p class="font-figtree text-5xl font-black text-[#780000] mb-2">17 955</p>
                  <p class="font-figtree text-sm text-[#003049]/60">essais possibles</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 3. Étape 2 : Créer l'Espace de Paramètres -->
        <div class="bg-[#003049] p-12 rounded-2xl relative overflow-hidden">
          <div class="absolute top-0 right-0 w-64 h-64 bg-[#780000] rounded-full filter blur-[100px] opacity-20 transform translate-x-1/2 -translate-y-1/2"></div>
          
          <div class="relative z-10">
            <h2 class="font-figtree text-3xl font-bold text-[#FFF9ED] mb-8">Étape 2 : Créer l'Espace de Paramètres</h2>

            <div class="space-y-8">
              <p class="font-figtree text-lg text-[#FFF9ED]/90 leading-relaxed">
                Définir l'espace de paramètres 4D complet pour la Théorie des Perspectives. Pour chaque paramètre, créer une grille fine de valeurs possibles.
              </p>

              <div class="bg-[#FFF9ED]/5 border border-[#FFF9ED]/10 p-8 rounded-xl backdrop-blur-sm">
                <p class="font-figtree text-lg font-bold text-[#FFF9ED] mb-6 border-b border-[#FFF9ED]/10 pb-4">Grilles de Paramètres (50 valeurs chacune)</p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                  <div>
                    <span class="block text-[#669bbc] font-bold text-xl mb-1">α</span>
                    <span class="text-[#FFF9ED]/60 text-sm">0,5 à 1,0</span>
                  </div>
                  <div>
                    <span class="block text-[#669bbc] font-bold text-xl mb-1">γ⁺</span>
                    <span class="text-[#FFF9ED]/60 text-sm">0,4 à 3,0</span>
                  </div>
                  <div>
                    <span class="block text-[#669bbc] font-bold text-xl mb-1">δ⁻</span>
                    <span class="text-[#FFF9ED]/60 text-sm">0,4 à 3,0</span>
                  </div>
                  <div>
                    <span class="block text-[#669bbc] font-bold text-xl mb-1">λ</span>
                    <span class="text-[#FFF9ED]/60 text-sm">1,0 à 6,0</span>
                  </div>
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-[#FFF9ED]/10 p-6 rounded-xl text-center">
                  <p class="font-figtree text-sm font-bold text-[#FFF9ED]/60 mb-2">Combinaisons</p>
                  <p class="font-figtree text-3xl font-bold text-[#FFF9ED]">6,25 Millions</p>
                </div>
                <div class="bg-[#FFF9ED]/10 p-6 rounded-xl text-center">
                  <p class="font-figtree text-sm font-bold text-[#FFF9ED]/60 mb-2">Tâches Parallèles</p>
                  <p class="font-figtree text-3xl font-bold text-[#FFF9ED]">250</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 4. Étape 3 : Calculer les Équivalents Certains -->
        <div class="pl-8 border-l-2 border-[#780000]/30">
          <div class="bg-[#FFF9ED] p-8 rounded-2xl border border-[#003049]/10 shadow-sm">
            <h2 class="font-figtree text-3xl font-bold text-[#003049] mb-8">Étape 3 : Calculer les Équivalents Certains</h2>

            <div class="space-y-8">
              <p class="font-figtree text-xl text-[#003049]/80 leading-relaxed font-light">
                Pour chaque combinaison de paramètres et chaque essai, calculer l'<strong>équivalent certain (CE)</strong>—la valeur qui rend quelqu'un indifférent entre accepter et refuser le pari.
              </p>

              <div class="bg-[#FFF9ED] border border-[#003049]/10 p-8 rounded-xl shadow-sm">
                <p class="font-figtree text-lg font-bold text-[#003049] mb-4">Implémentation de la Théorie des Perspectives</p>
                <div class="space-y-2 font-mono text-sm text-[#003049]/70 bg-[#003049]/5 p-4 rounded-lg">
                  <p>v(x) = x^α pour les gains</p>
                  <p>v(x) = -λ × |x|^α pour les pertes</p>
                  <p>w(p) = p^γ / (p^γ + (1-p)^γ)^(1/γ)</p>
                  <p class="text-[#780000] font-bold mt-2">CE = v(gain) × w(p_gain) + v(loss) × w(p_loss)</p>
                </div>
              </div>

              <div class="grid grid-cols-2 md:grid-cols-5 gap-6 text-center items-center">
                <div class="bg-[#780000]/5 border border-[#780000]/10 p-6 rounded-xl">
                  <p class="font-figtree text-sm font-bold text-[#780000] mb-2">Calculs</p>
                  <p class="font-figtree text-4xl font-black text-[#003049]">112 Milliards</p>
                  <p class="font-figtree text-xs text-[#003049]/60 mt-1">6,25M params × 17 955 essais</p>
                </div>
                <div class="flex items-center justify-center text-[#003049]/30 font-black text-2xl hidden md:flex">
                  =
                </div>
                <div class="bg-[#669bbc]/5 border border-[#669bbc]/10 p-6 rounded-xl md:col-span-2">
                  <p class="font-figtree text-sm font-bold text-[#669bbc] mb-2">Temps d'exécution</p>
                  <p class="font-figtree text-4xl font-black text-[#003049]">~63 Heures</p>
                  <p class="font-figtree text-xs text-[#003049]/60 mt-1">Temps CPU (250 tâches parallèles)</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 5. Étape 4 : Filtrer -->
        <div class="bg-[#FFF9ED] border border-[#003049]/10 rounded-2xl p-8 md:p-12 shadow-sm">
          <h2 class="font-figtree text-3xl font-bold text-[#003049] mb-8">Étape 4 : Filtrer vers les Essais Discriminants</h2>
          
          <div class="grid md:grid-cols-2 gap-12">
            <div class="space-y-6">
              <p class="font-figtree text-lg text-[#003049]/80 leading-relaxed">
                D'abord, éliminer les essais qui ne varient pas avec les valeurs de paramètres. Si tout le monde accepte un essai (ou tout le monde le refuse) indépendamment de ses paramètres, il ne fournit <em class="italic">aucune information</em>.
              </p>
              <div class="space-y-3">
                <div class="flex items-center gap-3 text-[#003049]/80 font-figtree">
                  <span class="w-6 h-6 rounded-full bg-[#669bbc]/20 text-[#669bbc] flex items-center justify-center font-bold text-xs">1</span>
                  <span>Franchissement de seuil (CE traverse 0)</span>
                </div>
                <div class="flex items-center gap-3 text-[#003049]/80 font-figtree">
                  <span class="w-6 h-6 rounded-full bg-[#669bbc]/20 text-[#669bbc] flex items-center justify-center font-bold text-xs">2</span>
                  <span>Plage suffisante (Plage ≥ 0,5)</span>
                </div>
                <div class="flex items-center gap-3 text-[#003049]/80 font-figtree">
                  <span class="w-6 h-6 rounded-full bg-[#669bbc]/20 text-[#669bbc] flex items-center justify-center font-bold text-xs">3</span>
                  <span>Éviter le consensus (< 95% d'accord)</span>
                </div>
              </div>
            </div>

            <div class="bg-[#003049]/5 rounded-xl p-8 flex flex-col justify-center items-center text-center">
              <p class="font-figtree text-sm font-bold text-[#003049]/60 mb-4 uppercase tracking-wide">Résultats du Filtrage</p>
              <div class="flex items-center gap-4 mb-2">
                <span class="text-2xl font-bold text-[#003049]/40 line-through">17,955</span>
                <span class="text-[#003049]/40">→</span>
                <span class="text-5xl font-black text-[#669bbc]">7,169</span>
              </div>
              <p class="font-figtree text-sm text-[#003049]/60">Essais discriminants retenus</p>
            </div>
          </div>
        </div>

        <!-- 6. Étape 5 : Dérivées -->
        <div class="bg-[#003049] p-12 rounded-2xl relative overflow-hidden">
           <div class="absolute inset-0 opacity-10">
             <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
                <pattern id="grid-deriv" width="20" height="20" patternUnits="userSpaceOnUse">
                  <circle cx="2" cy="2" r="1" fill="#FFF9ED"/>
                </pattern>
                <rect width="100%" height="100%" fill="url(#grid-deriv)" />
             </svg>
          </div>
          <div class="relative z-10">
            <h2 class="font-figtree text-3xl font-bold text-[#FFF9ED] mb-8">Étape 5 : Calculer les Dérivées</h2>
            
            <div class="space-y-8">
              <p class="font-figtree text-lg text-[#FFF9ED]/90 leading-relaxed max-w-3xl">
                L'Information de Fisher quantifie combien un essai vous en dit sur un paramètre. Elle est basée sur les <strong>dérivées</strong> : de combien l'équivalent certain change-t-il quand vous modifiez α, λ, γ⁺, or δ⁻ ?
              </p>

              <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-[#FFF9ED]/10 border border-[#FFF9ED]/20 p-8 rounded-xl backdrop-blur-sm">
                  <p class="font-figtree text-4xl font-black text-[#FFF9ED] mb-2">179 Trillions</p>
                  <p class="font-figtree text-sm text-[#FFF9ED]/70">Dérivées calculées par différences centrales</p>
                </div>
                <div class="bg-[#FFF9ED]/10 border border-[#FFF9ED]/20 p-8 rounded-xl backdrop-blur-sm">
                  <p class="font-figtree text-4xl font-black text-[#FFF9ED] mb-2">15 000</p>
                  <p class="font-figtree text-sm text-[#FFF9ED]/70">Heures-CPU sur cluster HPC</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 7. Étape 6 : Sélection -->
        <div class="pl-8 border-l-2 border-[#669bbc]/30">
          <div class="bg-[#FFF9ED] p-8 rounded-2xl border border-[#003049]/10 shadow-sm">
            <h2 class="font-figtree text-3xl font-bold text-[#003049] mb-8">Étape 6 : Sélection Séquentielle D-optimale</h2>

            <div class="space-y-8">
              <p class="font-figtree text-lg text-[#003049]/80 leading-relaxed">
                Maintenant vient l'optimisation. Nous voulons des essais qui <strong>maximisent l'information</strong> tout en maintenant l'<strong>équilibre</strong> entre les quatre paramètres.
              </p>

              <div class="bg-[#FFF9ED] border border-[#669bbc]/20 p-8 rounded-xl shadow-sm">
                <p class="font-figtree text-lg font-bold text-[#669bbc] mb-6">L'Algorithme</p>
                <div class="space-y-4">
                  <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-[#669bbc] rounded-lg flex items-center justify-center text-[#FFF9ED] font-bold text-sm">1</div>
                    <p class="font-figtree text-[#003049]/80 pt-1">Calculer la Matrice d'Information de Fisher pour chaque candidat</p>
                  </div>
                  <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-[#669bbc] rounded-lg flex items-center justify-center text-[#FFF9ED] font-bold text-sm">2</div>
                    <p class="font-figtree text-[#003049]/80 pt-1">Ajouter l'essai qui maximise le <strong>déterminant</strong> (information globale)</p>
                  </div>
                  <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-[#669bbc] rounded-lg flex items-center justify-center text-[#FFF9ED] font-bold text-sm">3</div>
                    <p class="font-figtree text-[#003049]/80 pt-1">Assurer la contrainte d'<strong>équilibre</strong> (ratio diagonal min/max ≥ 0,05)</p>
                  </div>
                  <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-[#669bbc] rounded-lg flex items-center justify-center text-[#FFF9ED] font-bold text-sm">4</div>
                    <p class="font-figtree text-[#003049]/80 pt-1">Répéter jusqu'à atteindre la cible de <strong>300 essais</strong></p>
                  </div>
                </div>
              </div>

              <div class="flex items-center justify-center gap-4 py-4">
                <div class="text-center">
                  <p class="font-figtree text-sm text-[#003049]/60 mb-1">Sélection Finale</p>
                  <p class="font-figtree text-4xl font-black text-[#003049]">286</p>
                  <p class="font-figtree text-xs text-[#003049]/40">Essais Optimaux</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Result -->
        <div class="bg-[#FFF9ED] border-4 border-[#003049] p-8 md:p-12 rounded-2xl shadow-lg">
          <h2 class="font-figtree text-3xl font-bold text-[#003049] mb-8">Le Résultat : Estimations de Précision</h2>
          
          <p class="font-figtree text-lg text-[#003049]/80 leading-relaxed mb-8">
            La Matrice d'Information de Fisher nous dit avec quelle précision nous pouvons estimer chaque paramètre. La précision est mesurée par les <strong>erreurs standard</strong> (SE)—plus petit est mieux.
          </p>

          <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            <div class="p-4 bg-[#780000]/5 rounded-lg border border-[#780000]/10 text-center">
              <p class="text-xs font-bold text-[#780000] uppercase tracking-wider mb-2">α (Sensibilité)</p>
              <p class="text-2xl font-black text-[#003049]">0,0147</p>
              <p class="text-xs text-[#003049]/60 mt-1">Excellent</p>
            </div>
            <div class="p-4 bg-[#669bbc]/5 rounded-lg border border-[#669bbc]/10 text-center">
              <p class="text-xs font-bold text-[#669bbc] uppercase tracking-wider mb-2">γ⁺ (Gain)</p>
              <p class="text-2xl font-black text-[#003049]">0,0296</p>
              <p class="text-xs text-[#003049]/60 mt-1">Très Bien</p>
            </div>
            <div class="p-4 bg-[#780000]/5 rounded-lg border border-[#780000]/10 text-center">
              <p class="text-xs font-bold text-[#780000] uppercase tracking-wider mb-2">δ⁻ (Perte)</p>
              <p class="text-2xl font-black text-[#003049]">0,0538</p>
              <p class="text-xs text-[#003049]/60 mt-1">Bien</p>
            </div>
            <div class="p-4 bg-[#669bbc]/5 rounded-lg border border-[#669bbc]/10 text-center">
              <p class="text-xs font-bold text-[#669bbc] uppercase tracking-wider mb-2">λ (Aversion aux Pertes)</p>
              <p class="text-2xl font-black text-[#003049]">0,0761</p>
              <p class="text-xs text-[#003049]/60 mt-1">Acceptable</p>
            </div>
          </div>
        </div>

        <!-- Validation -->
        <div class="pl-8 border-l-2 border-[#669bbc]/30">
          <div class="bg-[#FFF9ED] p-8 rounded-2xl border border-[#003049]/10 shadow-sm">
            <h2 class="font-figtree text-3xl font-bold text-[#003049] mb-8">Validation: Parameter Recovery</h2>
            
            <div class="space-y-6">
              <p class="font-figtree text-lg text-[#003049]/80 leading-relaxed">
                La théorie c'est une chose. La <em class="italic font-serif">pratique</em> en est une autre. Nous avons validé la conception avec 502 simulations utilisant l'échantillonnage Hypercube Latin et du bruit ajouté.
              </p>

              <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-[#FFF9ED] border border-[#003049]/10 p-6 rounded-xl">
                  <p class="font-figtree text-sm font-bold text-[#003049]/60 mb-2">Taux de Convergence</p>
                  <p class="font-figtree text-3xl font-black text-[#669bbc]">99,6%</p>
                  <p class="font-figtree text-xs text-[#003049]/40 mt-1">500/502 réussis</p>
                </div>
                <div class="bg-[#FFF9ED] border border-[#003049]/10 p-6 rounded-xl">
                  <p class="font-figtree text-sm font-bold text-[#003049]/60 mb-2">Qualité de Récupération</p>
                  <p class="font-figtree text-3xl font-black text-[#003049]">Modérée</p>
                  <p class="font-figtree text-xs text-[#003049]/40 mt-1">Adéquat pour la comparaison intra-sujets</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Next Step -->
        <div class="bg-[#FFF9ED] border border-[#003049]/10 p-10 rounded-2xl text-center shadow-sm">
          <h2 class="font-figtree text-2xl font-bold text-[#003049] mb-4">Ensuite : Le Rendre Réel</h2>
          <p class="font-figtree text-lg text-[#003049]/80 leading-relaxed max-w-3xl mx-auto mb-8">
            Les mathématiques sont faites. Les essais sont sélectionnés. La conception est validée. Maintenant vient la partie passionnante : construire l'expérience réelle.
          </p>
          <a href={base + "fr/journey/implementation"} class="inline-flex items-center gap-2 px-8 py-4 bg-[#003049] text-[#FFF9ED] rounded-full font-bold hover:bg-[#780000] transition-colors shadow-lg hover:shadow-xl transform hover:-translate-y-1">
            Explorer la Phase 4 : Implémentation
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
          </a>
        </div>

      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="py-12 px-6 bg-[#003049] text-[#FFF9ED]">
    <div class="max-w-4xl mx-auto text-center">
      <p class="font-figtree text-lg mb-4 font-semibold">Himalaya Girard</p>
      <p class="font-figtree text-[#669bbc] mb-6">{t('footer.position', lang)}</p>
      <p class="font-figtree text-sm text-[#669bbc]/70 mt-8">
        {t('footer.rights', lang)}
      </p>
    </div>
  </footer>
</Layout>

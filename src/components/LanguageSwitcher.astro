---
// Language switcher - uses client-side JS to handle base path correctly
const baseUrl = import.meta.env.BASE_URL;
---

<a
  id="lang-switcher"
  href="#"
  class="fixed top-6 right-6 z-50 px-5 py-2.5 bg-[#003049] text-[#FFF9ED] rounded-full hover:bg-[#780000] transition-all duration-300 font-bold shadow-lg hover:shadow-xl hover:-translate-y-0.5 flex items-center gap-2 text-sm tracking-wide border border-[#FFF9ED]/10 backdrop-blur-sm"
  aria-label="Switch language"
  data-base={baseUrl}
>
  <span id="current-lang" class="opacity-70 font-medium">EN</span>
  <span class="w-px h-3 bg-[#FFF9ED]/30"></span>
  <span id="target-lang">FR</span>
</a>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const switcher = document.getElementById('lang-switcher') as HTMLAnchorElement;
    const currentLangSpan = document.getElementById('current-lang');
    const targetLangSpan = document.getElementById('target-lang');

    if (!switcher || !currentLangSpan || !targetLangSpan) return;

    const base = switcher.dataset.base || '/';
    const pathname = window.location.pathname;

    // Normalize base (ensure trailing slash)
    const normalizedBase = base.endsWith('/') ? base : base + '/';

    // Remove base from pathname to get relative path
    // e.g., "/Himalaya_Website_New/fr/about" -> "fr/about"
    let relativePath = pathname.startsWith(normalizedBase)
      ? pathname.slice(normalizedBase.length)
      : (pathname.startsWith(base.replace(/\/$/, ''))
          ? pathname.slice(base.replace(/\/$/, '').length + 1)
          : pathname.slice(1));

    // Check if French (starts with 'fr/' or is exactly 'fr')
    const isFrench = relativePath.startsWith('fr/') || relativePath === 'fr';

    // Update display
    currentLangSpan.textContent = isFrench ? 'FR' : 'EN';
    targetLangSpan.textContent = isFrench ? 'EN' : 'FR';
    switcher.setAttribute('aria-label', `Switch to ${isFrench ? 'English' : 'French'}`);

    // Build switch URL
    let switchUrl: string;
    if (isFrench) {
      // Remove 'fr/' or 'fr' from start to go to English
      const pathWithoutLang = relativePath.replace(/^fr\/?/, '');
      switchUrl = normalizedBase + pathWithoutLang;
    } else {
      // Add 'fr/' prefix to go to French
      switchUrl = normalizedBase + 'fr/' + relativePath;
    }

    // Clean up double slashes (except in protocol) and trailing slashes on non-root
    switchUrl = switchUrl.replace(/([^:])\/+/g, '$1/');

    // Ensure root paths end with slash
    if (switchUrl === normalizedBase.replace(/\/$/, '')) {
      switchUrl = normalizedBase;
    }

    switcher.href = switchUrl;
  });
</script>

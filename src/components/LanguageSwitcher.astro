---
import { getLanguageFromUrl } from '../i18n/translations';

const currentLang = getLanguageFromUrl(Astro.url);
const otherLang = currentLang === 'en' ? 'fr' : 'en';
const otherLangLabel = currentLang === 'en' ? 'FR' : 'EN';

// Get the current page path from the URL
const pathname = Astro.url.pathname;

// Extract just the page name (e.g., "/about", "/journey", "/")
// Remove any base path and language prefix
const pathParts = pathname.split('/').filter(Boolean);

// Remove base path segment if present (e.g., "Himalaya_Website_New")
let cleanParts = [...pathParts];
if (cleanParts[0] === 'Himalaya_Website_New') {
  cleanParts.shift();
}

// Remove language prefix if present
if (cleanParts[0] === 'fr' || cleanParts[0] === 'en') {
  cleanParts.shift();
}

// The remaining path is the page path
const pagePath = cleanParts.length > 0 ? '/' + cleanParts.join('/') : '';

// Build switch URL using BASE_URL
const base = import.meta.env.BASE_URL;
let switchUrl: string;
if (otherLang === 'fr') {
  switchUrl = `${base}fr${pagePath}`;
} else {
  // For English, no /en prefix needed
  switchUrl = pagePath ? `${base.replace(/\/$/, '')}${pagePath}` : base;
}
---

<a
  href={switchUrl}
  class="fixed top-6 right-6 z-50 px-5 py-2.5 bg-[#003049] text-[#FFF9ED] rounded-full hover:bg-[#780000] transition-all duration-300 font-bold shadow-lg hover:shadow-xl hover:-translate-y-0.5 flex items-center gap-2 text-sm tracking-wide border border-[#FFF9ED]/10 backdrop-blur-sm"
  aria-label={`Switch to ${otherLang === 'fr' ? 'French' : 'English'}`}
>
  <span class="opacity-70 font-medium">{currentLang === 'en' ? 'EN' : 'FR'}</span>
  <span class="w-px h-3 bg-[#FFF9ED]/30"></span>
  <span>{otherLangLabel}</span>
</a>

---
// Language switcher - uses client-side JS to handle base path correctly
const baseUrl = import.meta.env.BASE_URL;
---

<a
  id="lang-switcher"
  href="#"
  class="fixed top-6 right-6 z-50 px-5 py-2.5 bg-[#003049] text-[#FFF9ED] rounded-full hover:bg-[#780000] transition-all duration-300 font-bold shadow-lg hover:shadow-xl hover:-translate-y-0.5 flex items-center gap-2 text-sm tracking-wide border border-[#FFF9ED]/10 backdrop-blur-sm"
  data-base={baseUrl}
>
  <span id="current-lang" class="opacity-70 font-medium">EN</span>
  <span class="w-px h-3 bg-[#FFF9ED]/30"></span>
  <span id="target-lang">FR</span>
</a>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const switcher = document.getElementById('lang-switcher') as HTMLAnchorElement;
    const currentLangSpan = document.getElementById('current-lang');
    const targetLangSpan = document.getElementById('target-lang');

    if (!switcher || !currentLangSpan || !targetLangSpan) return;

    const base = switcher.dataset.base || '/';
    const pathname = window.location.pathname;

    // Check if we're on French version
    const isFrench = pathname.includes('/fr/') || pathname.endsWith('/fr');

    // Update display
    currentLangSpan.textContent = isFrench ? 'FR' : 'EN';
    targetLangSpan.textContent = isFrench ? 'EN' : 'FR';
    switcher.setAttribute('aria-label', `Switch to ${isFrench ? 'English' : 'French'}`);

    // Build the switch URL
    let switchUrl: string;

    if (isFrench) {
      // Going to English: remove /fr from path
      switchUrl = pathname.replace('/fr/', '/').replace('/fr', '');
      if (switchUrl === base.replace(/\/$/, '')) {
        switchUrl = base;
      }
    } else {
      // Going to French: add /fr after base
      const pathAfterBase = pathname.replace(base.replace(/\/$/, ''), '');
      switchUrl = base + 'fr' + (pathAfterBase || '');
    }

    switcher.href = switchUrl;
  });
</script>
